# 日报聚合展示网站 - 技术文档

## 项目概述

一个基于 VitePress 的静态网站，自动从 GitHub 日报仓库同步日报内容，生成美观的展示页面，并通过 GitHub Pages 自动部署。

## 技术架构

### 技术栈

- **静态站点生成器**: VitePress 1.x
- **前端框架**: Vue 3
- **样式**: Tailwind CSS（可选）
- **部署**: GitHub Pages
- **CI/CD**: GitHub Actions
- **搜索**: VitePress 内置搜索

### 架构图

```
┌─────────────────┐
│  日报桌面应用    │
└────────┬────────┘
         │ 提交日报
         ↓
┌─────────────────┐
│ GitHub 日报仓库  │
│  (daily-reports) │
└────────┬────────┘
         │ Webhook/定时触发
         ↓
┌─────────────────┐
│ GitHub Actions  │
│  - 同步日报      │
│  - 生成索引      │
│  - 构建网站      │
└────────┬────────┘
         │ 部署
         ↓
┌─────────────────┐
│ GitHub Pages    │
│  (静态网站)      │
└─────────────────┘
```

## 项目结构

```
daily-reports-site/
├── .github/
│   └── workflows/
│       └── deploy.yml              # 自动部署配置
│
├── docs/
│   ├── .vitepress/
│   │   ├── config.ts              # VitePress 配置
│   │   ├── theme/
│   │   │   ├── index.ts           # 自定义主题入口
│   │   │   ├── Layout.vue         # 自定义布局
│   │   │   ├── components/
│   │   │   │   ├── Calendar.vue   # 日历组件
│   │   │   │   ├── Timeline.vue   # 时间线组件
│   │   │   │   ├── Stats.vue      # 统计组件
│   │   │   │   └── Search.vue     # 搜索组件
│   │   │   └── styles/
│   │   │       └── custom.css     # 自定义样式
│   │   ├── reports-index.json     # 日报索引（自动生成）
│   │   └── reports-index.data.ts  # 数据加载器
│   │
│   ├── public/                     # 静态资源
│   │   └── favicon.ico
│   │
│   ├── reports/                    # 日报文件（自动同步）
│   │   └── 2026/
│   │       ├── 01/
│   │       │   ├── 01.md
│   │       │   └── 02.md
│   │       └── 02/
│   │           └── 11.md
│   │
│   ├── index.md                    # 首页
│   ├── calendar.md                 # 日历视图
│   ├── archive.md                  # 归档页面
│   └── stats.md                    # 统计页面
│
├── scripts/
│   ├── sync-reports.js             # 同步日报脚本
│   ├── generate-index.js           # 生成索引脚本
│   └── generate-stats.js           # 生成统计数据
│
├── package.json
├── tsconfig.json
└── README.md
```

## 核心功能实现

### 1. 日报同步脚本

```javascript
// scripts/sync-reports.js
const { execSync } = require('child_process');
const fs = require('fs-extra');
const path = require('path');

async function syncReports() {
  const tempDir = 'temp-reports';
  const targetDir = 'docs/reports';
  
  try {
    // 克隆日报仓库
    console.log('正在同步日报...');
    execSync(`git clone --depth 1 https://github.com/用户名/daily-reports.git ${tempDir}`);
    
    // 清空目标目录
    await fs.emptyDir(targetDir);
    
    // 复制日报文件（只复制年/月/日.md 结构）
    const years = await fs.readdir(tempDir);
    for (const year of years) {
      if (!/^\d{4}$/.test(year)) continue;
      
      const yearPath = path.join(tempDir, year);
      const stat = await fs.stat(yearPath);
      if (!stat.isDirectory()) continue;
      
      const months = await fs.readdir(yearPath);
      for (const month of months) {
        if (!/^\d{2}$/.test(month)) continue;
        
        const monthPath = path.join(yearPath, month);
        const targetMonthPath = path.join(targetDir, year, month);
        
        // 复制整个月份目录
        await fs.copy(monthPath, targetMonthPath);
      }
    }
    
    // 清理临时目录
    await fs.remove(tempDir);
    
    console.log('日报同步完成！');
  } catch (error) {
    console.error('同步失败:', error);
    process.exit(1);
  }
}

syncReports();
```

### 2. 索引生成脚本

```javascript
// scripts/generate-index.js
const fs = require('fs-extra');
const path = require('path');
const matter = require('gray-matter');

async function generateIndex() {
  const reportsDir = 'docs/reports';
  const reports = [];
  
  // 递归读取所有日报
  async function walkDir(dir, yearMonth = '') {
    const files = await fs.readdir(dir);
    
    for (const file of files) {
      const filePath = path.join(dir, file);
      const stat = await fs.stat(filePath);
      
      if (stat.isDirectory()) {
        await walkDir(filePath, path.join(yearMonth, file));
      } else if (file.endsWith('.md')) {
        // 读取文件内容
        const content = await fs.readFile(filePath, 'utf-8');
        const { data: frontmatter, content: markdown } = matter(content);
        
        // 提取信息
        const pathParts = filePath.split(path.sep);
        const year = pathParts[pathParts.length - 3];
        const month = pathParts[pathParts.length - 2];
        const day = path.basename(file, '.md');
        
        const date = `${year}-${month}-${day}`;
        const title = frontmatter.title || extractTitle(markdown) || `${date} 日报`;
        const summary = extractSummary(markdown);
        const tags = frontmatter.tags || [];
        
        reports.push({
          date,
          year,
          month,
          day,
          title,
          summary,
          tags,
          path: `/reports/${year}/${month}/${day}`,
          wordCount: markdown.length
        });
      }
    }
  }
  
  await walkDir(reportsDir);
  
  // 按日期倒序排序
  reports.sort((a, b) => new Date(b.date) - new Date(a.date));
  
  // 生成索引文件
  await fs.writeJson('docs/.vitepress/reports-index.json', reports, { spaces: 2 });
  
  // 生成统计数据
  const stats = generateStats(reports);
  await fs.writeJson('docs/.vitepress/stats.json', stats, { spaces: 2 });
  
  console.log(`已生成 ${reports.length} 篇日报的索引`);
}

function extractTitle(markdown) {
  const match = markdown.match(/^#\s+(.+)$/m);
  return match ? match[1] : null;
}

function extractSummary(markdown, maxLength = 150) {
  // 移除标题和代码块
  let text = markdown
    .replace(/^#.+$/gm, '')
    .replace(/```[\s\S]*?```/g, '')
    .replace(/`[^`]+`/g, '')
    .trim();
  
  // 截取前 N 个字符
  if (text.length > maxLength) {
    text = text.substring(0, maxLength) + '...';
  }
  
  return text;
}

function generateStats(reports) {
  const now = new Date();
  const thisYear = now.getFullYear();
  const thisMonth = now.getMonth() + 1;
  
  // 计算连续天数
  let streak = 0;
  const sortedDates = reports.map(r => r.date).sort().reverse();
  let currentDate = new Date();
  
  for (const dateStr of sortedDates) {
    const date = new Date(dateStr);
    const diffDays = Math.floor((currentDate - date) / (1000 * 60 * 60 * 24));
    
    if (diffDays === streak) {
      streak++;
      currentDate = date;
    } else {
      break;
    }
  }
  
  return {
    total: reports.length,
    streak,
    thisYear: reports.filter(r => r.year === String(thisYear)).length,
    thisMonth: reports.filter(r => 
      r.year === String(thisYear) && 
      r.month === String(thisMonth).padStart(2, '0')
    ).length,
    totalWords: reports.reduce((sum, r) => sum + r.wordCount, 0),
    avgWords: Math.round(reports.reduce((sum, r) => sum + r.wordCount, 0) / reports.length),
    byMonth: groupByMonth(reports),
    byYear: groupByYear(reports)
  };
}

function groupByMonth(reports) {
  const grouped = {};
  reports.forEach(r => {
    const key = `${r.year}-${r.month}`;
    grouped[key] = (grouped[key] || 0) + 1;
  });
  return grouped;
}

function groupByYear(reports) {
  const grouped = {};
  reports.forEach(r => {
    grouped[r.year] = (grouped[r.year] || 0) + 1;
  });
  return grouped;
}

generateIndex();
```

### 3. VitePress 配置

```typescript
// docs/.vitepress/config.ts
import { defineConfig } from 'vitepress';

export default defineConfig({
  title: '我的日报',
  description: '记录每一天的成长',
  lang: 'zh-CN',
  
  // 主题配置
  themeConfig: {
    logo: '/logo.png',
    
    nav: [
      { text: '首页', link: '/' },
      { text: '日历', link: '/calendar' },
      { text: '归档', link: '/archive' },
      { text: '统计', link: '/stats' }
    ],
    
    sidebar: {
      '/reports/': 'auto'
    },
    
    // 搜索
    search: {
      provider: 'local',
      options: {
        translations: {
          button: {
            buttonText: '搜索日报',
            buttonAriaLabel: '搜索日报'
          },
          modal: {
            noResultsText: '无法找到相关结果',
            resetButtonTitle: '清除查询条件',
            footer: {
              selectText: '选择',
              navigateText: '切换'
            }
          }
        }
      }
    },
    
    // 社交链接
    socialLinks: [
      { icon: 'github', link: 'https://github.com/用户名/daily-reports' }
    ],
    
    // 页脚
    footer: {
      message: '基于 VitePress 构建',
      copyright: 'Copyright © 2026'
    }
  },
  
  // Markdown 配置
  markdown: {
    theme: {
      light: 'github-light',
      dark: 'github-dark'
    },
    lineNumbers: true,
    
    // 代码高亮
    languages: ['javascript', 'typescript', 'python', 'bash', 'json']
  },
  
  // 构建配置
  build: {
    outDir: '../dist'
  },
  
  // 站点地图
  sitemap: {
    hostname: 'https://用户名.github.io/daily-reports-site'
  }
});
```

### 4. 数据加载器

```typescript
// docs/.vitepress/reports-index.data.ts
import { createContentLoader } from 'vitepress';
import reportsIndex from './reports-index.json';

export default {
  load() {
    return reportsIndex;
  }
};
```

### 5. 首页组件

```vue
<!-- docs/index.md -->
---
layout: home

hero:
  name: 我的日报
  text: 记录每一天的成长
  tagline: 持续记录，见证进步
  image:
    src: /hero.png
    alt: 日报
  actions:
    - theme: brand
      text: 查看最新
      link: /reports/latest
    - theme: alt
      text: 日历视图
      link: /calendar
---

<script setup lang="ts">
import { data as reports } from './.vitepress/reports-index.data';
import { data as stats } from './.vitepress/stats.data';

const recentReports = reports.slice(0, 10);
</script>

<div class="home-content">
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-value">{{ stats.total }}</div>
      <div class="stat-label">总日报数</div>
    </div>
    <div class="stat-card">
      <div class="stat-value">{{ stats.streak }}</div>
      <div class="stat-label">连续天数</div>
    </div>
    <div class="stat-card">
      <div class="stat-value">{{ stats.thisMonth }}</div>
      <div class="stat-label">本月日报</div>
    </div>
    <div class="stat-card">
      <div class="stat-value">{{ stats.avgWords }}</div>
      <div class="stat-label">平均字数</div>
    </div>
  </div>

  <h2>最近日报</h2>
  <div class="reports-list">
    <div v-for="report in recentReports" :key="report.date" class="report-item">
      <div class="report-date">{{ report.date }}</div>
      <h3><a :href="report.path">{{ report.title }}</a></h3>
      <p class="report-summary">{{ report.summary }}</p>
      <div class="report-tags">
        <span v-for="tag in report.tags" :key="tag" class="tag">{{ tag }}</span>
      </div>
    </div>
  </div>
</div>

<style scoped>
.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 1rem;
  margin: 2rem 0;
}

.stat-card {
  padding: 1.5rem;
  background: var(--vp-c-bg-soft);
  border-radius: 8px;
  text-align: center;
}

.stat-value {
  font-size: 2rem;
  font-weight: bold;
  color: var(--vp-c-brand);
}

.stat-label {
  margin-top: 0.5rem;
  color: var(--vp-c-text-2);
}

.reports-list {
  margin-top: 2rem;
}

.report-item {
  padding: 1.5rem;
  margin-bottom: 1rem;
  background: var(--vp-c-bg-soft);
  border-radius: 8px;
  border-left: 4px solid var(--vp-c-brand);
}

.report-date {
  font-size: 0.875rem;
  color: var(--vp-c-text-2);
  margin-bottom: 0.5rem;
}

.report-summary {
  color: var(--vp-c-text-2);
  margin: 0.5rem 0;
}

.report-tags {
  display: flex;
  gap: 0.5rem;
  margin-top: 0.5rem;
}

.tag {
  padding: 0.25rem 0.75rem;
  background: var(--vp-c-brand-soft);
  color: var(--vp-c-brand);
  border-radius: 4px;
  font-size: 0.875rem;
}
</style>
```

### 6. GitHub Actions 部署

```yaml
# .github/workflows/deploy.yml
name: 部署日报网站

on:
  # 手动触发
  workflow_dispatch:
  
  # 定时触发（每天 UTC 0点，北京时间 8点）
  schedule:
    - cron: '0 0 * * *'
  
  # 推送到 main 分支时触发
  push:
    branches: [main]

# 设置权限
permissions:
  contents: read
  pages: write
  id-token: write

# 只允许一个并发部署
concurrency:
  group: pages
  cancel-in-progress: false

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
      - name: 检出代码
        uses: actions/checkout@v4
      
      - name: 设置 Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
      
      - name: 安装依赖
        run: npm ci
      
      - name: 同步日报
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: node scripts/sync-reports.js
      
      - name: 生成索引
        run: node scripts/generate-index.js
      
      - name: 构建网站
        run: npm run build
      
      - name: 上传构建产物
        uses: actions/upload-pages-artifact@v3
        with:
          path: docs/.vitepress/dist
  
  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    
    runs-on: ubuntu-latest
    needs: build
    
    steps:
      - name: 部署到 GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
```

## 部署步骤

### 1. 创建网站仓库

```bash
# 创建新仓库
mkdir daily-reports-site
cd daily-reports-site
git init

# 初始化项目
npm init -y
npm install -D vitepress vue gray-matter fs-extra
```

### 2. 配置 GitHub Pages

1. 推送代码到 GitHub
2. 进入仓库 Settings → Pages
3. Source 选择 "GitHub Actions"

### 3. 配置访问权限

如果日报仓库是私有的，需要配置 Personal Access Token：
1. 创建 PAT（需要 `repo` 权限）
2. 在网站仓库添加 Secret：`REPORTS_TOKEN`
3. 在同步脚本中使用该 Token

## 访问地址

```
https://用户名.github.io/daily-reports-site/
```

## 性能优化

1. **静态生成**: 所有页面预渲染，访问速度快
2. **增量构建**: 只重新构建变化的页面
3. **代码分割**: 按需加载组件
4. **图片优化**: 使用 WebP 格式
5. **CDN 加速**: GitHub Pages 自带 CDN

## 扩展功能

### 1. RSS 订阅

```javascript
// scripts/generate-rss.js
const RSS = require('rss');
const fs = require('fs-extra');

async function generateRSS(reports) {
  const feed = new RSS({
    title: '我的日报',
    description: '每日工作记录',
    feed_url: 'https://用户名.github.io/daily-reports-site/rss.xml',
    site_url: 'https://用户名.github.io/daily-reports-site',
    language: 'zh-CN'
  });
  
  reports.slice(0, 20).forEach(report => {
    feed.item({
      title: report.title,
      description: report.summary,
      url: `https://用户名.github.io/daily-reports-site${report.path}`,
      date: report.date
    });
  });
  
  await fs.writeFile('docs/public/rss.xml', feed.xml());
}
```

### 2. 评论系统（Giscus）

```vue
<!-- docs/.vitepress/theme/components/Comments.vue -->
<template>
  <div class="comments">
    <Giscus
      repo="用户名/daily-reports-site"
      repo-id="你的仓库ID"
      category="Comments"
      category-id="分类ID"
      mapping="pathname"
      reactions-enabled="1"
      emit-metadata="0"
      theme="preferred_color_scheme"
      lang="zh-CN"
    />
  </div>
</template>

<script setup>
import Giscus from '@giscus/vue';
</script>
```

## 维护

- **自动化**: GitHub Actions 自动同步和部署
- **成本**: 完全免费
- **更新**: 每天自动检查更新
- **备份**: GitHub 自动备份

这个方案提供了完整的日报展示和管理功能，完全自动化，零维护成本！
