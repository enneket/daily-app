# v1.0.2 版本发布

## 发布信息

- **版本号**：v1.0.2
- **发布日期**：2026-02-24
- **版本类型**：Bug 修复 + 功能增强

## 更新内容

### 🐛 Bug 修复

#### 修复窗口图标显示问题

**问题描述**：
在 Windows 打包应用中，窗口标题栏和任务栏显示的是通用文档图标（📄），而不是自定义的应用图标。

**根本原因**：
图标文件被打包进了 `app.asar` 内部，而 `nativeImage.createFromPath()` 无法读取 asar 内部的文件。

**解决方案**：
1. 使用 `extraResources` 配置将图标文件放在 asar 外部
2. 添加多路径尝试机制，提高图标加载成功率
3. 使用 `nativeImage` API 正确加载图标
4. 添加详细的调试日志，便于问题排查

**影响范围**：
- Windows 打包应用的窗口图标
- 任务栏图标
- Alt+Tab 切换器中的图标

### ✨ 新增功能

#### 单实例锁定

**功能描述**：
防止应用被多次打开，确保同时只能运行一个实例。

**功能特性**：
1. **单实例限制**：应用启动时请求单实例锁，如果已有实例在运行，新实例自动退出
2. **窗口聚焦**：尝试打开第二个实例时，自动激活已存在的窗口
3. **智能恢复**：如果窗口被最小化，会自动恢复并聚焦

**使用场景**：
- 防止数据冲突（避免多个实例同时修改日报）
- 改善用户体验（点击快捷方式直接激活已打开的窗口）
- 资源优化（减少内存占用）

## 技术改进

### 1. 打包配置优化

```json
"extraResources": [
  {
    "from": "build",
    "to": "build",
    "filter": ["**/*"]
  }
]
```

将图标文件放在 asar 外部，确保运行时能正确访问。

### 2. 图标加载优化

```typescript
// 尝试多个可能的路径
const possiblePaths = [
  path.join(process.resourcesPath, 'build', iconName),
  path.join(path.dirname(app.getPath('exe')), 'resources', 'build', iconName),
  path.join(app.getAppPath(), 'build', iconName),
  path.join(__dirname, '../../build', iconName),
];

// 找到存在的图标文件
iconPath = possiblePaths.find(p => fs.existsSync(p)) || possiblePaths[0];
```

### 3. 单实例锁定实现

```typescript
const gotTheLock = app.requestSingleInstanceLock();

if (!gotTheLock) {
  app.quit();
} else {
  app.on('second-instance', () => {
    if (mainWindow) {
      if (mainWindow.isMinimized()) {
        mainWindow.restore();
      }
      mainWindow.focus();
    }
  });
}
```

### 4. 调试日志增强

添加日志文件输出功能，日志位置：
- Windows: `%APPDATA%\DailyReport\icon-debug.log`
- macOS: `~/Library/Application Support/DailyReport/icon-debug.log`
- Linux: `~/.config/DailyReport/icon-debug.log`

## 升级指南

### 从 v1.0.1 升级

1. 下载最新版本安装包
2. 运行安装程序（会自动覆盖旧版本）
3. 启动应用，配置会自动保留

### 配置迁移

无需手动迁移，应用会自动使用现有配置。

## 已知问题

### 开发环境图标显示

在 Linux/WSL 开发环境中通过 X11 转发运行时，图标显示可能不正确。这是 X11 协议的限制，不影响打包后的应用。

**解决方案**：
- 在目标平台（Windows）上测试打包后的应用
- 或在 Windows 上直接运行开发环境

## 测试建议

### 功能测试

1. **图标显示测试**
   - 检查窗口标题栏图标
   - 检查任务栏图标
   - 检查 Alt+Tab 切换器中的图标

2. **单实例测试**
   - 启动应用
   - 再次尝试启动应用
   - 验证第二个实例是否自动退出
   - 验证第一个窗口是否获得焦点

3. **最小化恢复测试**
   - 启动应用并最小化
   - 再次尝试启动应用
   - 验证窗口是否自动恢复并聚焦

### 回归测试

- [ ] 日报编辑功能正常
- [ ] GitHub 配置保存正常
- [ ] 日报提交功能正常
- [ ] 日报读取功能正常
- [ ] 仓库初始化功能正常

## 下载

### Windows

- 安装包：`DailyReport-Setup-1.0.2.exe`
- 便携版：`DailyReport-1.0.2-win.zip`

### macOS

- DMG 安装包：`DailyReport-1.0.2.dmg`

### Linux

- AppImage：`DailyReport-1.0.2.AppImage`
- Deb 包：`daily-report-app_1.0.2_amd64.deb`

## 反馈

如有问题或建议，请通过以下方式反馈：
- GitHub Issues
- 邮箱：zhao.jiaxing@qq.com

## 致谢

感谢所有用户的反馈和支持！

---

**完整更新日志**：
- v1.2.8: 修复窗口图标显示问题
- v1.2.9: 添加单实例锁定功能
- v1.0.2: 正式版本发布
