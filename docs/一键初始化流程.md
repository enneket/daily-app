# 一键初始化流程

## 概述

从版本 1.0.0 开始，日报桌面应用支持一键初始化日报仓库。只需保存 GitHub 配置，应用会自动完成所有设置。

## 完整流程

### 步骤 1：创建空仓库

在 GitHub 上创建一个新仓库（例如：`daily`）

- 可以是完全空的仓库
- 也可以是已有日报的仓库

### 步骤 2：打开桌面应用

启动日报桌面应用，点击"设置"按钮。

### 步骤 3：填写配置

填写以下信息：

- **GitHub Token**：你的 Personal Access Token（需要 `repo` 权限）
- **仓库所有者**：你的 GitHub 用户名
- **仓库名称**：`daily`（你创建的仓库名）
- **分支名称**：`main`（默认）

### 步骤 4：保存并初始化

点击"保存并初始化"按钮。

应用会显示：
1. "正在保存配置并初始化仓库..."
2. 等待 10-30 秒
3. "配置已保存，仓库初始化完成！"

### 步骤 5：配置 GitHub Pages

这是唯一需要手动操作的步骤：

1. 访问 `https://github.com/你的用户名/daily/settings/pages`
2. Source 选择 "GitHub Actions"
3. 保存

### 步骤 6：开始使用

返回桌面应用，开始写日报！

每次提交日报后，网站会自动更新。

## 自动初始化的内容

应用会自动创建：

### 1. 网站文件（site/）

- `.vitepress/config.ts` - VitePress 配置
- `.vitepress/reports-index.data.ts` - 日报索引加载器
- `.vitepress/stats.data.ts` - 统计数据加载器
- `index.md` - 首页
- `calendar.md` - 日历视图
- `archive.md` - 归档页面
- `stats.md` - 统计页面
- `latest.md` - 最新日报

### 2. 脚本文件（scripts/）

- `generate-index.js` - 日报索引生成脚本

### 3. 配置文件

- `package.json` - 包含网站构建脚本和依赖
- `.gitignore` - 忽略 node_modules 和构建产物
- `README.md` - 仓库说明文档

### 4. GitHub Actions（.github/workflows/）

- `deploy-site.yml` - 自动部署配置

## 工作原理

```
用户点击"保存并初始化"
         ↓
    测试 GitHub 连接
         ↓
检查 site/.vitepress/config.ts 是否存在
         ↓
    ┌────┴────┐
    ↓         ↓
  存在      不存在
    ↓         ↓
  跳过    自动创建所有文件
    ↓         ↓
    └────┬────┘
         ↓
    保存配置完成
         ↓
    显示成功消息
```

## 智能检测

应用会智能检测仓库状态：

- ✅ 如果仓库已初始化（存在 `site/.vitepress/config.ts`）→ 跳过初始化
- ✅ 如果仓库未初始化 → 自动创建所有文件
- ✅ 如果部分文件存在 → 只创建缺失的文件

这意味着：
- 可以安全地多次保存配置
- 不会覆盖已有文件
- 不会影响已有的日报

## 时间估算

- 测试连接：1-2 秒
- 检测初始化状态：1-2 秒
- 创建文件（如果需要）：10-30 秒
- 总计：10-35 秒

## 常见问题

### Q: 必须是空仓库吗？

A: 不必须。应用会检测是否已初始化，已有文件不会被覆盖。

### Q: 可以跳过初始化吗？

A: 不能跳过，但如果仓库已初始化，会自动跳过。

### Q: 初始化失败怎么办？

A: 检查：
- GitHub Token 是否有 `repo` 权限
- 仓库是否存在
- 网络连接是否正常

如果仍然失败，可以参考 [日报仓库快速设置](./日报仓库快速设置.md) 手动配置。

### Q: 初始化后可以修改配置吗？

A: 可以。所有文件都在 GitHub 仓库中，可以直接编辑。

### Q: 需要修改哪些配置？

A: 建议修改 `site/.vitepress/config.ts` 中的：
- `base: '/daily/'` - 必须与仓库名一致
- `title` - 网站标题
- `description` - 网站描述

### Q: 为什么网站显示 404？

A: 检查 `site/.vitepress/config.ts` 中的 `base` 是否与仓库名一致。

## 优势

相比手动配置：

| 手动配置 | 一键初始化 |
|---------|-----------|
| 需要克隆仓库 | 无需克隆 |
| 需要复制文件 | 自动创建 |
| 需要修改配置 | 自动配置 |
| 需要提交推送 | 自动提交 |
| 耗时 5-10 分钟 | 耗时 10-30 秒 |

## 下一步

初始化完成后：

1. ✅ 配置 GitHub Pages（一次性）
2. ✅ 开始写日报
3. ✅ 网站自动更新

## 相关文档

- [自动初始化功能说明](./自动初始化功能说明.md) - 详细的功能说明
- [日报仓库设置指南](./日报仓库设置指南.md) - 手动设置方法
- [使用说明](./使用说明.md) - 应用使用说明
