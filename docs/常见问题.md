# 常见问题

## 安装依赖问题

### 问题：npm install 失败，提示 lock 文件错误

```
npm error code ELOCKVERIFY
npm error Missing: illegalarg@1.0.4 from lock file
```

**原因**：`package-lock.json` 版本不匹配或损坏

**解决方案**：

#### 方案 1：删除 lock 文件重新安装（推荐）

```bash
# 删除 lock 文件和 node_modules
rm -rf package-lock.json node_modules

# 重新安装
npm install
```

#### 方案 2：使用 npm install 而不是 npm ci

```bash
npm install
```

#### 方案 3：清除 npm 缓存

```bash
npm cache clean --force
rm -rf node_modules package-lock.json
npm install
```

### 问题：安装很慢

**解决方案**：使用国内镜像

```bash
# 临时使用
npm install --registry=https://registry.npmmirror.com

# 永久配置
npm config set registry https://registry.npmmirror.com
```

## GitHub Actions 问题

### 问题：Linux 打包失败

```
Error: Please specify author 'email' in the application package.json
```

**解决方案**：在 `package.json` 中配置 author 信息

```json
"author": {
  "name": "你的名字",
  "email": "your.email@example.com"
}
```

详见 [配置说明.md](./配置说明.md)

### 问题：Actions 权限不足

**解决方案**：

1. 进入仓库 Settings → Actions → General
2. 找到 "Workflow permissions"
3. 选择 "Read and write permissions"
4. 保存

### 问题：部署网站失败

**解决方案**：

1. 确保 GitHub Pages 已启用
2. Settings → Pages → Source 选择 "GitHub Actions"
3. 检查 Actions 日志查看具体错误

## 开发问题

### 问题：Electron 启动失败（Linux）

```
Missing X server or $DISPLAY
```

**原因**：Linux 环境没有图形界面

**解决方案**：

1. 使用网页模式开发：`npm run dev`
2. 或在有图形界面的环境测试
3. 详见 [平台说明.md](./平台说明.md)

### 问题：热更新不工作

**解决方案**：

- 前端代码：自动热更新，检查浏览器控制台
- 主进程代码：需要重启 Electron

### 问题：TypeScript 编译错误

**解决方案**：

```bash
# 清除编译缓存
rm -rf dist

# 重新编译
npm run build
```

## 打包问题

### 问题：打包后应用无法启动

**检查项**：

1. 是否配置了 author 信息
2. 是否正确构建了代码
3. 查看应用日志

### 问题：打包文件太大

**说明**：Electron 应用包含完整的 Chromium 和 Node.js，大小正常：

- macOS DMG：约 100-150 MB
- Windows EXE：约 80-120 MB
- Linux AppImage：约 100-140 MB

### 问题：macOS 提示"无法验证开发者"

**解决方案**：

1. 打开"系统偏好设置" → "安全性与隐私"
2. 点击"仍要打开"

**生产环境**：需要 Apple Developer 账号进行代码签名

## 网站问题

### 问题：网站显示 404

**原因**：`base` 配置不正确

**解决方案**：

编辑 `site/.vitepress/config.ts`：

```typescript
export default defineConfig({
  base: '/你的仓库名/',  // 必须与仓库名一致
});
```

### 问题：搜索功能不工作

**说明**：VitePress 的搜索需要构建后才能使用，本地开发时可能不可用。

### 问题：网站没有更新

**解决方案**：

1. 检查 GitHub Actions 是否运行成功
2. 等待 2-3 分钟让部署完成
3. 清除浏览器缓存
4. 检查是否推送了 .md 文件

## 配置问题

### 问题：GitHub Token 无效

**解决方案**：

1. 检查 Token 是否过期
2. 检查 Token 权限（需要 `repo` 权限）
3. 重新生成 Token

### 问题：无法连接到 GitHub

**检查项**：

1. 网络连接是否正常
2. GitHub 是否可访问
3. Token 是否正确
4. 仓库名是否正确

## 性能问题

### 问题：应用启动慢

**说明**：Electron 应用首次启动需要加载 Chromium，属于正常现象。

**优化**：

- 减少启动时加载的模块
- 使用懒加载
- 优化资源大小

### 问题：内存占用高

**说明**：Electron 基于 Chromium，内存占用较高是正常的。

## 其他问题

### 问题：找不到某个命令

**解决方案**：

```bash
# 确保依赖已安装
npm install

# 检查 package.json 中的 scripts
npm run
```

### 问题：端口被占用

```
Error: listen EADDRINUSE: address already in use :::5173
```

**解决方案**：

```bash
# 查找占用端口的进程
lsof -i :5173

# 杀死进程
kill -9 <PID>

# 或使用其他端口
PORT=5174 npm run dev
```

### 问题：权限错误

```
Error: EACCES: permission denied
```

**解决方案**：

```bash
# Linux/macOS
sudo chown -R $USER:$USER .

# 或使用 sudo
sudo npm install
```

## 获取帮助

如果以上方案都无法解决问题：

1. 查看完整的错误日志
2. 搜索错误信息
3. 查看 GitHub Issues
4. 提交新的 Issue

## 调试技巧

### 查看详细日志

```bash
# npm 详细日志
npm install --verbose

# Electron 调试
npm run dev:electron --trace-warnings
```

### 清理环境

```bash
# 完全清理
rm -rf node_modules package-lock.json dist release
npm cache clean --force
npm install
```

### 检查版本

```bash
node --version    # 应该是 v18 或更高
npm --version     # 应该是 v9 或更高
```

## 预防措施

1. **定期更新依赖**：`npm update`
2. **提交前测试**：确保 `npm run build` 成功
3. **使用版本控制**：不要提交 `node_modules`
4. **备份配置**：保存重要的配置文件
5. **阅读文档**：遇到问题先查看文档
