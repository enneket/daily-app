# 日报仓库设置指南

## 概述

这个文档说明如何设置你的日报仓库，让它能够自动生成和部署展示网站。

## 仓库结构

你的日报仓库应该有以下结构：

```
your-daily-repo/              # 你的日报仓库
├── .github/
│   └── workflows/
│       └── deploy-site.yml   # 自动部署配置
├── site/                     # 网站源码
│   ├── .vitepress/
│   │   ├── config.ts
│   │   ├── reports-index.data.ts
│   │   └── stats.data.ts
│   ├── index.md
│   ├── calendar.md
│   ├── archive.md
│   ├── stats.md
│   └── latest.md
├── scripts/
│   └── generate-index.js     # 索引生成脚本
├── 2026/                     # 日报文件
│   └── 02/
│       └── 11.md
├── package.json
└── README.md
```

## 设置步骤

### 1. 创建日报仓库

```bash
# 在 GitHub 上创建新仓库，例如：daily-reports
# 克隆到本地
git clone https://github.com/你的用户名/daily-reports.git
cd daily-reports
```

### 2. 复制网站文件

从桌面应用仓库复制以下文件到日报仓库：

```bash
# 复制网站源码
cp -r /path/to/daily-report-app/site ./

# 复制脚本
cp -r /path/to/daily-report-app/scripts ./

# 复制 .gitignore 相关配置
# 添加以下内容到日报仓库的 .gitignore
```

`.gitignore` 内容：
```
node_modules
site/.vitepress/dist
site/.vitepress/cache
site/.vitepress/reports-index.json
site/.vitepress/stats.json
```

### 3. 创建 package.json

在日报仓库根目录创建 `package.json`：

```json
{
  "name": "daily-reports",
  "version": "1.0.0",
  "description": "我的日报",
  "type": "module",
  "scripts": {
    "build:site": "vitepress build site",
    "dev:site": "vitepress dev site",
    "preview:site": "vitepress preview site"
  },
  "devDependencies": {
    "fs-extra": "^11.2.0",
    "vitepress": "^1.0.0"
  }
}
```

### 4. 创建 GitHub Actions 配置

在日报仓库创建 `.github/workflows/deploy-site.yml`：

```yaml
name: 部署日报展示网站

on:
  push:
    branches: [main]
    paths:
      - '**.md'
      - '.github/workflows/deploy-site.yml'
      - 'scripts/**'
  workflow_dispatch:

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: pages
  cancel-in-progress: false

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
      - name: 检出代码
        uses: actions/checkout@v4
      
      - name: 设置 Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
      
      - name: 安装依赖
        run: npm install
      
      - name: 生成日报索引
        run: node scripts/generate-index.js
      
      - name: 构建网站
        run: npm run build:site
      
      - name: 上传构建产物
        uses: actions/upload-pages-artifact@v3
        with:
          path: site/.vitepress/dist
  
  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    
    runs-on: ubuntu-latest
    needs: build
    
    steps:
      - name: 部署到 GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
```

### 5. 配置网站信息

编辑 `site/.vitepress/config.ts`：

```typescript
import { defineConfig } from 'vitepress';

export default defineConfig({
  title: '我的日报',
  description: '记录每一天的成长',
  lang: 'zh-CN',
  
  base: '/daily-reports/',  // 改为你的仓库名
  
  themeConfig: {
    nav: [
      { text: '首页', link: '/' },
      { text: '日历', link: '/calendar' },
      { text: '归档', link: '/archive' },
      { text: '统计', link: '/stats' }
    ],
    
    search: {
      provider: 'local'
    },
    
    socialLinks: [
      { icon: 'github', link: 'https://github.com/你的用户名/daily-reports' }
    ]
  },
  
  sitemap: {
    hostname: 'https://你的用户名.github.io/daily-reports'
  }
});
```

### 6. 配置 GitHub Pages

1. 进入日报仓库的 Settings → Pages
2. Source 选择 "GitHub Actions"
3. 保存

### 7. 安装依赖并测试

```bash
# 在日报仓库目录
npm install

# 生成索引
node scripts/generate-index.js

# 本地预览
npm run dev:site
```

### 8. 提交并推送

```bash
git add .
git commit -m "添加日报展示网站"
git push
```

等待 2-3 分钟，访问：
```
https://你的用户名.github.io/daily-reports/
```

## 日常使用

### 通过桌面应用提交日报

1. 打开桌面应用
2. 配置 GitHub 信息（指向日报仓库）
3. 编写并提交日报

### 自动更新网站

每次提交日报后，GitHub Actions 会自动：
1. 检测到 .md 文件变化
2. 运行 `generate-index.js` 生成索引
3. 构建网站
4. 部署到 GitHub Pages

## 两个仓库的关系

```
桌面应用仓库 (daily-report-app)
    ↓ 使用应用
    ↓ 提交日报
日报仓库 (daily-reports)
    ├── 存储日报 (YYYY/MM/DD.md)
    ├── 网站源码 (site/)
    └── 自动部署 → GitHub Pages
```

## 目录说明

### 桌面应用仓库
- 包含桌面应用的源码
- 用于开发和打包应用
- 不包含日报数据

### 日报仓库
- 包含所有日报文件
- 包含网站源码和配置
- 通过 GitHub Actions 自动部署网站

## 注意事项

1. **仓库名要一致**：`site/.vitepress/config.ts` 中的 `base` 必须与仓库名一致
2. **不要混淆**：桌面应用仓库和日报仓库是两个独立的仓库
3. **权限配置**：确保 GitHub Actions 有部署权限
4. **分支名称**：默认使用 `main` 分支，如果是 `master` 需要修改 workflow

## 故障排除

### 网站显示 404
- 检查 `base` 配置是否正确
- 检查 GitHub Pages 是否启用

### Actions 失败
- 查看 Actions 日志
- 检查 `package.json` 是否正确
- 检查依赖是否安装成功

### 网站没有更新
- 等待 2-3 分钟
- 检查 Actions 是否运行成功
- 清除浏览器缓存

## 完整示例

查看示例仓库结构：
- 桌面应用：当前仓库
- 日报仓库：需要你自己创建

## 总结

1. 桌面应用仓库：开发和打包应用
2. 日报仓库：存储日报 + 展示网站
3. 两个仓库独立，通过 GitHub API 连接
