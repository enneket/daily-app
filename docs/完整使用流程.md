# 日报助手完整使用流程

## 概述

本文档描述从开发、打包、发布到使用的完整流程。

## 一、开发者流程

### 1.1 开发环境设置

```bash
# 克隆仓库
git clone https://github.com/你的用户名/daily-app.git
cd daily-app

# 安装依赖
npm install

# 开发模式
npm run dev  # 网页模式
# 或
npm run dev:electron  # 桌面模式
```

### 1.2 项目结构

```
daily-app/
├── src/
│   ├── main/              # Electron 主进程
│   │   ├── main.ts        # 主进程入口
│   │   ├── preload.ts     # 预加载脚本
│   │   └── github-service.ts  # GitHub API 服务
│   └── renderer/          # React 渲染进程
│       ├── App.tsx        # 应用主组件
│       ├── components/    # UI 组件
│       └── types.ts       # 类型定义
├── site/                  # 日报展示网站模板
│   ├── .vitepress/        # VitePress 配置
│   │   ├── config.ts      # 网站配置
│   │   ├── reports-index.data.ts  # 日报索引加载器
│   │   ├── stats.data.ts  # 统计数据加载器
│   │   ├── reports-index.json  # 默认索引文件
│   │   └── stats.json     # 默认统计文件
│   ├── index.md           # 首页
│   ├── calendar.md        # 日历视图
│   ├── archive.md         # 归档页面
│   ├── stats.md           # 统计页面
│   └── latest.md          # 最新日报
├── scripts/
│   └── generate-index.js  # 日报索引生成脚本
└── docs/                  # 文档目录
```

### 1.3 关键文件说明

#### src/main/github-service.ts
- 负责与 GitHub API 交互
- `initializeRepo()` 方法自动初始化日报仓库
- 推送所有必需文件到日报仓库

#### scripts/generate-index.js
- 扫描 `docs/` 目录下的日报文件
- 生成 `reports-index.json` 和 `stats.json`
- 使用 Node.js 内置模块，无需额外依赖

#### site/.vitepress/*.data.ts
- VitePress 数据加载器
- 读取 JSON 文件并提供给页面
- 包含安全的默认值处理

### 1.4 构建和打包

```bash
# 构建项目
npm run build

# 打包不同平台
npm run package:mac      # macOS
npm run package:win      # Windows
npm run package:linux    # Linux
npm run package:all      # 所有平台
```

打包后的文件在 `release/` 目录。

### 1.5 发布流程

#### 自动发布（推荐）

1. 创建 Git tag：
```bash
git tag v1.0.0
git push origin v1.0.0
```

2. GitHub Actions 自动构建并发布到 Releases

#### 手动发布

1. 本地打包
2. 上传到 GitHub Releases
3. 编写 Release Notes

## 二、用户流程

### 2.1 安装桌面应用

1. 访问 [Releases 页面](https://github.com/你的用户名/daily-app/releases)
2. 下载对应平台的安装包：
   - macOS: `.dmg` 文件
   - Windows: `.exe` 文件
   - Linux: `.AppImage` 或 `.deb` 文件
3. 安装应用

### 2.2 首次配置

#### 步骤 1：创建日报仓库

在 GitHub 上创建一个新仓库（例如：`daily`）：
- 可以是空仓库
- 不需要添加 README、.gitignore 或 License

#### 步骤 2：获取 GitHub Token

1. 访问 [GitHub Settings → Tokens](https://github.com/settings/tokens)
2. 点击 "Generate new token (classic)"
3. 勾选 `repo` 完整权限
4. 生成并复制 token

#### 步骤 3：配置桌面应用

1. 打开日报桌面应用
2. 点击"设置"按钮
3. 填写配置信息：
   - **GitHub Token**: 刚才生成的 token
   - **仓库所有者**: 你的 GitHub 用户名
   - **仓库名称**: `daily`（你创建的仓库名）
   - **分支名称**: `main`（默认）

4. 点击"保存并初始化"

#### 步骤 4：等待初始化

应用会自动：
- ✅ 测试 GitHub 连接
- ✅ 检测仓库是否已初始化
- ✅ 自动创建所有必需文件：
  - 网站源码（`site/` 目录）
  - 索引生成脚本（`scripts/generate-index.js`）
  - GitHub Actions 配置（`.github/workflows/deploy-site.yml`）
  - package.json、.gitignore、README.md
- ✅ 显示初始化结果

**初始化时间**: 10-30 秒（取决于网络速度）

#### 步骤 5：启用 GitHub Pages（重要！）

这是唯一需要手动操作的步骤，必须完成才能访问日报网站：

1. **访问 Pages 设置页面**：
   - 打开 `https://github.com/你的用户名/daily/settings/pages`
   - 或者：仓库页面 → Settings → 左侧菜单 Pages

2. **配置部署来源**：
   - 在 "Build and deployment" 部分
   - "Source" 下拉菜单选择 **"GitHub Actions"**
   - ⚠️ 不要选择 "Deploy from a branch"

3. **保存并等待**：
   - 选择后会自动保存
   - 页面会显示网站地址：`https://你的用户名.github.io/daily/`

4. **触发首次部署**：
   - 方法 1：使用桌面应用提交一篇日报
   - 方法 2：在 Actions 页面手动触发 workflow

5. **验证部署成功**：
   - 访问 `https://github.com/你的用户名/daily/actions`
   - 等待 workflow 执行完成（约 1-2 分钟）
   - 访问你的网站：`https://你的用户名.github.io/daily/`

**详细说明**：参见 [启用 GitHub Pages 文档](./启用GitHub-Pages.md)

### 2.3 日常使用

#### 编写日报

1. 打开桌面应用
2. 在文本框中输入日报内容（支持 Markdown）
3. 点击"提交"按钮或按 `Cmd/Ctrl + Enter`

#### 日报存储

日报自动保存到 GitHub 仓库：
- 路径格式：`docs/YYYY/MM/DD.md`
- 例如：`docs/2026/02/12.md`

#### 多次提交

同一天可以多次提交，新内容会追加到当天文件，带上时间戳。

#### 查看日报

等待 2-3 分钟后，访问：
```
https://你的用户名.github.io/daily/
```

网站会自动更新，展示所有日报。

## 三、日报仓库结构

初始化完成后，日报仓库结构如下：

```
daily/                          # 日报仓库
├── .github/
│   └── workflows/
│       └── deploy-site.yml     # 自动部署配置
├── docs/                       # 日报目录
│   └── 2026/
│       └── 02/
│           └── 12.md           # 日报文件
├── site/                       # 网站源码
│   ├── .vitepress/
│   │   ├── config.ts
│   │   ├── reports-index.data.ts
│   │   ├── stats.data.ts
│   │   ├── reports-index.json
│   │   └── stats.json
│   ├── index.md
│   ├── calendar.md
│   ├── archive.md
│   ├── stats.md
│   └── latest.md
├── scripts/
│   └── generate-index.js       # 索引生成脚本
├── .gitignore
├── package.json
└── README.md
```

## 四、自动化流程

### 4.1 提交日报后的自动流程

```
用户提交日报
    ↓
桌面应用通过 GitHub API 创建/更新文件
    ↓
GitHub 仓库收到新的 .md 文件
    ↓
GitHub Actions 自动触发
    ↓
1. 检出代码
2. 安装依赖 (npm install)
3. 生成索引 (node scripts/generate-index.js)
4. 构建网站 (npm run build:site)
5. 部署到 GitHub Pages
    ↓
网站自动更新（2-3 分钟）
```

### 4.2 索引生成流程

`scripts/generate-index.js` 的工作流程：

```
扫描 docs/ 目录
    ↓
查找所有 YYYY/MM/DD.md 文件
    ↓
提取每个文件的：
  - 标题
  - 摘要
  - 时间条目
  - 字数
    ↓
生成 reports-index.json（日报列表）
生成 stats.json（统计数据）
    ↓
VitePress 构建时读取这些 JSON 文件
    ↓
生成静态网站
```

## 五、技术细节

### 5.1 桌面应用技术栈

- **Electron**: 跨平台桌面框架
- **React 18**: UI 框架
- **TypeScript**: 类型安全
- **Tailwind CSS**: 样式框架
- **Octokit**: GitHub API 客户端
- **electron-store**: 本地配置存储
- **Vite**: 构建工具

### 5.2 网站技术栈

- **VitePress**: 静态网站生成器
- **Vue 3**: 页面交互
- **Node.js**: 索引生成脚本

### 5.3 关键设计决策

#### 为什么使用两个仓库？

1. **桌面应用仓库**：
   - 包含应用源码
   - 用于开发和打包
   - 不包含用户数据

2. **日报仓库**：
   - 包含用户的日报数据
   - 包含网站源码
   - 自动部署网站

**优势**：
- 数据和代码分离
- 用户数据私有化
- 应用更新不影响用户数据

#### 为什么自动初始化？

- 降低使用门槛
- 避免手动配置错误
- 确保文件版本一致

#### 为什么使用 GitHub Actions？

- 自动化部署
- 无需本地构建
- 免费托管

## 六、故障排除

### 6.1 初始化失败

**可能原因**：
- GitHub Token 权限不足
- 仓库不存在
- 网络连接问题

**解决方法**：
1. 检查 Token 是否有 `repo` 完整权限
2. 确认仓库已创建
3. 检查网络连接

### 6.2 网站构建失败

**可能原因**：
- JSON 文件格式错误
- 依赖安装失败
- VitePress 版本问题

**解决方法**：
1. 检查 GitHub Actions 日志
2. 确认 package.json 正确
3. 重新初始化仓库

### 6.3 网站显示 404

**可能原因**：
- GitHub Pages 未启用
- `base` 配置不正确

**解决方法**：
1. 检查 Settings → Pages 是否选择 "GitHub Actions"
2. 检查 `site/.vitepress/config.ts` 中的 `base` 是否与仓库名一致

### 6.4 日报提交失败

**可能原因**：
- Token 过期
- 网络问题
- 仓库权限问题

**解决方法**：
1. 重新生成 Token
2. 检查网络连接
3. 确认对仓库有写权限

## 七、最佳实践

### 7.1 日报编写

- 使用 Markdown 格式
- 按时间点组织内容
- 记录关键工作和思考
- 保持简洁明了

### 7.2 仓库管理

- 定期备份日报仓库
- 不要手动修改自动生成的文件
- 可以自定义网站样式和配置

### 7.3 安全建议

- 不要分享 GitHub Token
- 使用最小权限原则
- 定期更新 Token
- 日报仓库可以设为私有

## 八、更新和维护

### 8.1 更新桌面应用

1. 下载新版本安装包
2. 安装覆盖旧版本
3. 配置会自动保留

### 8.2 更新日报仓库文件

如果桌面应用更新了网站模板：

**方法 1：重新初始化**
1. 备份日报文件
2. 删除 `site/.vitepress/config.ts`
3. 重新保存配置
4. 应用会自动推送新文件

**方法 2：手动更新**
- 参考 `docs/更新日报仓库文件.md`

### 8.3 自定义网站

可以修改的文件：
- `site/.vitepress/config.ts` - 网站配置
- `site/*.md` - 页面内容
- CSS 样式

不要修改的文件：
- `reports-index.json` - 自动生成
- `stats.json` - 自动生成
- `scripts/generate-index.js` - 核心脚本

## 九、常见问题

### Q: 可以在多台设备使用吗？

A: 可以。在每台设备上安装应用并配置相同的仓库信息即可。

### Q: 支持离线使用吗？

A: 不支持。需要网络连接才能提交到 GitHub。

### Q: 可以修改已提交的日报吗？

A: 可以。直接在 GitHub 仓库中编辑对应的 .md 文件。

### Q: 日报数据存储在哪里？

A: 存储在你的 GitHub 仓库中，完全由你控制。

### Q: Token 存储安全吗？

A: Token 使用 electron-store 加密存储在本地，不会上传到任何服务器。

### Q: 可以导出日报吗？

A: 可以。日报都是 Markdown 文件，可以直接从 GitHub 仓库下载。

## 十、总结

完整流程概览：

```
开发者                          用户
   ↓                             ↓
开发应用                      下载安装
   ↓                             ↓
打包发布                      创建仓库
   ↓                             ↓
GitHub Releases              获取 Token
                                ↓
                             配置应用
                                ↓
                          自动初始化仓库
                                ↓
                          配置 GitHub Pages
                                ↓
                             编写日报
                                ↓
                             提交日报
                                ↓
                        GitHub Actions 自动构建
                                ↓
                            网站自动更新
                                ↓
                            在线查看日报
```

整个流程设计目标：
- ✅ 简单易用
- ✅ 自动化程度高
- ✅ 数据安全可控
- ✅ 免费托管
- ✅ 跨平台支持

## 相关文档

- [快速开始](./快速开始.md)
- [使用说明](./使用说明.md)
- [自动初始化功能说明](./自动初始化功能说明.md)
- [日报仓库设置指南](./日报仓库设置指南.md)
- [打包指南](./打包指南.md)
