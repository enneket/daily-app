# 自动初始化功能说明

## 功能概述

从 v0.0.1 版本开始，日报桌面应用支持自动初始化日报仓库。当你保存 GitHub 配置时，应用会自动检测仓库是否已配置网站，如果没有，会自动复制所需的文件。

## 工作流程

1. 用户在桌面应用中配置 GitHub 信息
2. 点击"保存"按钮
3. 应用检测到仓库未初始化
4. 自动创建以下文件：
   - `site/` - 网站源码
   - `scripts/` - 构建脚本
   - `.github/workflows/deploy-site.yml` - 自动部署配置
   - `package.json` - 依赖配置
   - `.gitignore` - Git 忽略配置
   - `README.md` - 仓库说明
5. 初始化完成，可以开始提交日报

## 使用步骤

### 1. 创建空仓库

在 GitHub 上创建一个新的空仓库，例如 `daily-reports`。

**注意**：
- 不要勾选 "Add a README file"
- 不要添加 .gitignore
- 不要选择 License
- 保持仓库完全为空

### 2. 配置桌面应用

打开日报桌面应用，点击设置，填写：

- **GitHub Token**：你的 Personal Access Token（需要 repo 权限）
- **仓库所有者**：你的 GitHub 用户名
- **仓库名称**：daily-reports（你创建的仓库名）
- **分支名称**：main

### 步骤 4：保存并初始化

点击"保存并初始化"按钮。

应用会自动：
1. 测试 GitHub 连接
2. 检测仓库是否已初始化（检查 `site/.vitepress/config.ts` 是否存在）
3. 根据检测结果：
   - **如果仓库未初始化**：自动创建所有必要文件，显示"配置已保存，仓库初始化完成！"
   - **如果仓库已初始化**：跳过初始化，显示"配置已保存！仓库已初始化，无需重复设置。"

**首次初始化可能需要 10-30 秒**，请耐心等待，不要关闭应用。

### 4. 配置 GitHub Pages

初始化完成后，需要手动配置一次 GitHub Pages：

1. 进入你的日报仓库
2. 点击 Settings → Pages
3. Source 选择 "GitHub Actions"
4. 保存

### 5. 开始写日报

返回桌面应用主界面，开始写日报并提交。

### 6. 等待部署

GitHub Actions 会自动构建和部署网站，等待 2-3 分钟后访问：

```
https://你的用户名.github.io/仓库名/
```

## 自动创建的文件

### 网站文件

```
site/
├── .vitepress/
│   ├── config.ts           # 网站配置
│   ├── reports-index.data.ts  # 日报索引
│   └── stats.data.ts       # 统计数据
├── index.md                # 首页
├── calendar.md             # 日历视图
├── archive.md              # 归档页面
├── stats.md                # 统计页面
└── latest.md               # 最新日报
```

### 构建脚本

```
scripts/
└── generate-index.js       # 生成日报索引
```

### GitHub Actions

```
.github/
└── workflows/
    └── deploy-site.yml     # 自动部署配置
```

### 配置文件

- `package.json` - Node.js 依赖配置
- `.gitignore` - Git 忽略规则
- `README.md` - 仓库说明文档

## 自动更新

初始化完成后，每次提交日报时：

1. 日报内容自动保存到 `YYYY/MM/DD.md`
2. GitHub Actions 自动触发
3. 重新生成索引
4. 重新构建网站
5. 自动部署到 GitHub Pages

## 常见问题

### Q: 保存配置时卡住了怎么办？

A: 初始化需要创建多个文件，可能需要 1-2 分钟。如果超过 3 分钟还没完成，检查：
- GitHub Token 是否有 repo 权限
- 仓库是否存在
- 网络连接是否正常

### Q: 初始化失败怎么办？

A: 检查以下几点：
- GitHub Token 是否有 repo 权限
- 仓库是否存在
- 网络连接是否正常
- 查看应用的开发者工具（如果有错误信息）

### Q: 可以跳过初始化吗？

A: 初始化检测是自动的：
- 如果仓库已经有 `site/.vitepress/config.ts` 文件，会自动跳过初始化
- 如果仓库未初始化，会自动创建所有必要文件
- 应用会明确告诉你是否进行了初始化

### Q: 测试连接成功但没有初始化？

A: 点击"保存并初始化"按钮才会触发初始化，"测试连接"按钮只测试连接，不会初始化仓库。

### Q: 已有仓库会被覆盖吗？

A: 不会。应用会先检测 `site/.vitepress/config.ts` 是否存在：
- 如果存在，跳过初始化，显示"仓库已初始化，无需重复设置"
- 如果不存在，才会创建文件
- 已有的日报文件不会受到任何影响

### Q: 初始化后可以修改配置吗？

A: 可以。所有文件都在 GitHub 仓库中，你可以直接编辑。

### Q: 需要修改哪些配置？

A: 初始化后，建议修改 `site/.vitepress/config.ts` 中的：
- `title` - 网站标题
- `description` - 网站描述
- `base` - 必须与仓库名一致
- `socialLinks` - 你的 GitHub 链接
- `sitemap.hostname` - 你的网站域名

### Q: 为什么网站显示 404？

A: 检查 `site/.vitepress/config.ts` 中的 `base` 配置是否与仓库名一致。

## 技术细节

### 触发时机

初始化在保存配置时触发，而不是提交日报时。这样用户可以立即看到初始化结果。

### 检测逻辑

应用通过检查 `site/.vitepress/config.ts` 文件是否存在来判断仓库是否已初始化。

### 文件来源

所有文件都打包在应用内部，从以下位置读取：
- `site/` - 网站源码
- `scripts/` - 构建脚本
- `docs/日报仓库README模板.md` - README 模板

### 上传方式

使用 GitHub API 逐个创建文件，每个文件一个 commit。

## 优势

1. **零配置**：无需手动复制文件
2. **自动化**：一键完成仓库初始化
3. **可靠性**：自动检测，避免重复初始化
4. **灵活性**：初始化后可自由修改

## 注意事项

1. 首次提交会比较慢（1-2 分钟）
2. 确保 GitHub Token 有足够权限
3. 仓库最好是空的，避免冲突
4. 初始化后记得配置 GitHub Pages
