# 修复统计页面 ClientOnly 渲染

## 问题描述

统计页面显示原始 HTML 代码而不是渲染后的内容：
- 显示 `<div class="stat-card">` 等原始标签
- Vue 组件没有正确渲染
- 数据没有正确显示

## 问题原因

VitePress 的服务端渲染（SSR）与客户端 hydration 不匹配，导致 Vue 组件无法正确渲染。

这是因为：
1. 统计页面使用了复杂的 Vue 响应式逻辑
2. 数据在服务端和客户端可能不一致
3. SSR 时 Vue 组件的状态与客户端不匹配

## 解决方案

使用 VitePress 的 `<ClientOnly>` 组件包裹统计页面内容，确保只在客户端渲染。

### ClientOnly 组件

`<ClientOnly>` 是 VitePress 提供的特殊组件，用于：
- 跳过服务端渲染
- 只在客户端执行渲染
- 避免 SSR hydration 不匹配问题

### 实现方式

**修改前**：
```vue
# 总体统计

<script setup>
...
</script>

<div class="stats-container">
  ...
</div>
```

**修改后**：
```vue
# 总体统计

<ClientOnly>
<script setup>
...
</script>

<div class="stats-container">
  ...
</div>
</ClientOnly>
```

## 技术细节

### 为什么需要 ClientOnly？

1. **数据加载时机**：
   - SSR 时数据可能还未加载
   - 客户端 hydration 时数据已加载
   - 导致状态不匹配

2. **响应式数据**：
   - Vue 的响应式系统在 SSR 和客户端行为不同
   - 复杂的计算属性可能导致不一致

3. **DOM 操作**：
   - 某些操作只能在客户端执行
   - SSR 时无法访问 window、document 等

### ClientOnly 的工作原理

1. **SSR 阶段**：
   - 跳过 `<ClientOnly>` 内的内容
   - 生成占位符

2. **客户端 hydration**：
   - 移除占位符
   - 渲染实际内容

3. **结果**：
   - 避免 SSR/客户端不匹配
   - 确保正确渲染

## 影响范围

- `site/stats.md` - 添加 ClientOnly 包裹
- `src/main/github-service.ts` - 更新版本号

## 版本

- 版本号：v1.2.6
- 更新内容：使用 ClientOnly 修复统计页面渲染问题

## 测试验证

- [ ] 统计页面正确显示数据
- [ ] 不再显示原始 HTML 代码
- [ ] 总日报数、连续天数等数据正确
- [ ] 按年/按月统计正确显示
- [ ] 页面样式正常

## 注意事项

### 性能影响

使用 `<ClientOnly>` 会导致：
- 首屏不显示统计内容（显示空白或加载中）
- 客户端 JavaScript 加载后才显示
- 对 SEO 有轻微影响（统计数据不被搜索引擎索引）

但这是可接受的，因为：
- 统计页面主要供用户查看，不需要 SEO
- 避免渲染错误比首屏性能更重要
- 加载速度通常很快，用户感知不明显

### 其他页面

目前只有统计页面需要 `<ClientOnly>`：
- 日历页面（v1.2.0）已简化，不需要
- 归档页面（v1.2.0）已简化，不需要
- 首页数据较简单，不需要

## 相关问题

### v1.2.1 的修复

v1.2.1 修复了统计页面对象遍历问题，将 `v-for` 遍历对象改为遍历数组。但这只解决了部分问题，SSR hydration 问题仍然存在。

### 为什么之前没发现？

可能的原因：
1. 本地开发模式（`npm run dev:site`）不使用 SSR
2. 某些浏览器或网络环境下问题不明显
3. 数据量较小时问题不明显

## 替代方案

如果 `<ClientOnly>` 不能解决问题，可以考虑：

1. **完全静态化**：
   - 在构建时生成静态 HTML
   - 不使用 Vue 响应式
   - 类似 v1.2.0 的简化方案

2. **延迟加载**：
   - 使用 `v-if` 和 `onMounted`
   - 等待客户端加载完成后再渲染

3. **服务端数据预取**：
   - 在 SSR 时正确加载数据
   - 确保服务端和客户端数据一致
