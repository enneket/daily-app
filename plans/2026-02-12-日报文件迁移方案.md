# 日报文件迁移方案

## 问题描述

用户反馈详情页 404：`https://enneket.github.io/daily/docs/2026/02/12.html`

经检查发现：
1. 日报文件目前存储在 `docs/2026/02/12.md`（旧位置）
2. 桌面应用代码已改为 `site/docs/`（新位置）
3. VitePress 只构建 `site/` 目录下的文件
4. 导致旧位置的日报文件无法被 VitePress 处理

## 根本原因

虽然桌面应用的代码已经更新（v1.2.2），但：
1. 用户的日报仓库中已有的日报文件还在旧位置
2. 需要将 `docs/` 目录下的日报迁移到 `site/docs/`

## 解决方案

提供两种迁移方案：

### 方案 1：自动迁移脚本（推荐）

创建一个迁移脚本，在桌面应用初始化时自动执行：
1. 检查 `docs/` 目录是否存在日报文件
2. 如果存在，将所有日报文件移动到 `site/docs/`
3. 删除旧的 `docs/` 目录

### 方案 2：手动迁移指南

在文档中提供手动迁移步骤：
```bash
# 在日报仓库中执行
mkdir -p site/docs
cp -r docs/* site/docs/
rm -rf docs
```

## 实施计划

### 1. 创建迁移脚本

创建 `scripts/migrate-reports.js`：
- 扫描 `docs/` 目录
- 复制所有日报文件到 `site/docs/`
- 保持目录结构不变
- 删除旧的 `docs/` 目录

### 2. 修改桌面应用

修改 `src/main/github-service.ts`：
- 在 `updateRepoFiles()` 中添加迁移脚本
- 在初始化时自动执行迁移
- 检测到旧文件时提示用户

### 3. 更新文档

更新以下文档：
- `docs/完整使用流程.md` - 添加迁移说明
- `docs/常见问题.md` - 添加 404 问题解决方案
- `docs/日报仓库README模板.md` - 更新目录结构说明

## 技术细节

### 迁移脚本逻辑

```javascript
// 检查旧目录
if (exists('docs/') && !exists('site/docs/')) {
  // 创建新目录
  mkdir('site/docs')
  // 复制文件
  copyRecursive('docs/', 'site/docs/')
  // 删除旧目录
  rmdir('docs/')
}
```

### GitHub API 操作

1. 列出 `docs/` 目录下的所有文件
2. 逐个读取文件内容
3. 在 `site/docs/` 创建相同的文件
4. 删除 `docs/` 目录下的文件

## 版本更新

- 版本号：v1.2.3
- 更新内容：添加日报文件自动迁移功能

## 影响范围

- `scripts/migrate-reports.js` - 新建迁移脚本
- `src/main/github-service.ts` - 添加迁移逻辑
- `docs/完整使用流程.md` - 更新文档
- `docs/常见问题.md` - 添加 FAQ

## 测试验证

- [ ] 迁移脚本能正确识别旧文件
- [ ] 文件迁移后目录结构正确
- [ ] VitePress 能正确构建迁移后的文件
- [ ] 详情页可以正常访问
- [ ] 旧目录被正确删除

## 用户操作步骤

1. 更新桌面应用到 v1.2.3
2. 打开应用，点击"保存并初始化"
3. 应用会自动检测并迁移旧文件
4. 等待迁移完成
5. 验证详情页可以访问
