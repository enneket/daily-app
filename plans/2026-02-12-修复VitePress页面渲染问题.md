# 修复 VitePress 页面渲染问题

## 问题描述

网站部署后，多个页面显示原始 Vue 模板代码而不是渲染后的内容：
- 日历视图：显示 `<div v-for="(day, index) in monthDays">`
- 归档页面：显示 `<div class="filter-group" v-if="selectedYear !== 'all'">`
- 统计页面：显示原始模板代码
- 日报详情页：404 错误

## 根本原因分析

1. **Vue 组件未激活**：VitePress 生成了静态 HTML，但客户端 JavaScript 没有正确激活（hydrate）这些组件
2. **路径问题**：日报详情页的路径可能不正确

## 解决方案

### 方案 A：简化页面实现（推荐）

将复杂的 Vue 组件改为更简单的实现，减少客户端 JavaScript 依赖。

**优点**：
- 更可靠，不依赖复杂的客户端渲染
- 加载更快
- SEO 更友好

**缺点**：
- 交互性可能降低
- 需要重写部分页面

### 方案 B：修复 hydration 问题

深入调试 VitePress 的 hydration 问题，确保客户端 JavaScript 正确执行。

**优点**：
- 保留完整的交互功能
- 不需要重写页面

**缺点**：
- 调试复杂
- 可能需要修改 VitePress 配置或构建流程

### 方案 C：使用静态生成

将动态内容在构建时生成为静态 HTML，不依赖客户端 JavaScript。

**优点**：
- 完全静态，无 JavaScript 依赖
- 性能最佳

**缺点**：
- 无交互功能（如筛选、搜索）
- 需要完全重写页面

## 推荐实施方案

采用 **方案 A + 部分方案 C**：

1. **日历视图**：简化为静态月历，点击日期跳转到日报详情
2. **归档页面**：使用服务器端生成的分组列表，移除客户端筛选
3. **统计页面**：使用静态卡片展示统计数据
4. **日报详情**：修复路径问题

## 实施步骤

### 第 1 步：修复日报详情路径

日报文件存储在 `docs/YYYY/MM/DD.md`，但 VitePress 需要正确的路由配置。

**问题**：
- 存储路径：`docs/2026/02/12.md`
- 访问路径：`/docs/2026/02/12`（可能 404）

**解决**：
确保 VitePress 能正确处理 `docs/` 目录下的文件。

### 第 2 步：简化日历视图

**当前实现**：
- 使用 Vue 响应式数据
- 客户端计算月份天数
- 动态渲染日历格子

**简化方案**：
- 在数据加载器中预计算月份数据
- 使用简单的 `v-for` 渲染
- 减少计算属性和响应式逻辑

### 第 3 步：简化归档页面

**当前实现**：
- 客户端筛选功能
- 动态下拉菜单
- 响应式过滤

**简化方案**：
- 按年月分组，服务器端生成
- 使用锚点链接导航
- 移除客户端筛选

### 第 4 步：简化统计页面

**当前实现**：
- 动态加载统计数据
- 客户端渲染图表

**简化方案**：
- 静态卡片展示数字
- 移除复杂的图表
- 使用简单的列表

## 技术细节

### VitePress 的限制

VitePress 主要设计用于文档网站，对于复杂的 SPA 应用支持有限：

1. **SSR 优先**：主要生成静态 HTML
2. **有限的客户端状态**：不适合复杂的客户端应用
3. **路由限制**：基于文件系统的路由

### 最佳实践

1. **尽量使用静态内容**
2. **减少客户端 JavaScript**
3. **使用数据加载器预处理数据**
4. **避免复杂的响应式逻辑**

## 测试计划

1. **本地测试**：
   - `npm run build:site`
   - `npm run preview:site`
   - 验证所有页面正常显示

2. **部署测试**：
   - 推送到 GitHub
   - 等待构建完成
   - 访问所有页面验证

## 成功标准

- [ ] 所有页面正常显示（无原始模板代码）
- [ ] 日报详情页可以访问
- [ ] 日历视图可以查看和导航
- [ ] 归档页面可以浏览所有日报
- [ ] 统计页面显示正确的数据

## 风险评估

### 风险 1：功能降级
**影响**：用户体验可能不如原设计
**缓解**：保留核心功能，移除非必要的交互

### 风险 2：需要大量重写
**影响**：开发时间增加
**缓解**：优先修复关键页面，逐步优化

### 风险 3：仍然无法解决
**影响**：可能需要更换技术方案
**缓解**：准备备选方案（如使用 Next.js 或 Nuxt）

## 备选方案

如果 VitePress 无法满足需求，考虑：

1. **Docusaurus**：更适合文档 + 博客
2. **Next.js**：完整的 React 框架
3. **Nuxt**：完整的 Vue 框架
4. **纯静态 HTML**：最简单但功能有限

## 相关文件

- `site/calendar.md` - 日历视图
- `site/archive.md` - 归档页面
- `site/stats.md` - 统计页面
- `site/index.md` - 首页
- `site/latest.md` - 最新日报
- `site/.vitepress/config.ts` - VitePress 配置
- `site/.vitepress/reports-index.data.ts` - 数据加载器
